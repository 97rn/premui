local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local Library = {}

function Library:Create(Config)
    local Main = {
        Title = Config.Title or "Library",
        SubTitle = Config.SubTitle or "v1.0.0",
        LoaderEnabled = Config.Loader or false
    }

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "ModernUI_" .. math.random(100, 999)
    ScreenGui.Parent = CoreGui
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local Container = Instance.new("Frame")
    Container.Name = "Main"
    Container.Size = UDim2.new(0, 550, 0, 350)
    Container.Position = UDim2.new(0.5, -275, 0.5, -175)
    Container.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Container.BorderSizePixel = 0
    Container.ClipsDescendants = true
    Container.Visible = not Main.LoaderEnabled
    Container.Parent = ScreenGui

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 8)
    UICorner.Parent = Container

    local TopBar = Instance.new("Frame")
    TopBar.Name = "TopBar"
    TopBar.Size = UDim2.new(1, 0, 0, 40)
    TopBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    TopBar.BorderSizePixel = 0
    TopBar.Parent = Container

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Text = Main.Title .. " | " .. Main.SubTitle
    TitleLabel.Size = UDim2.new(1, -100, 1, 0)
    TitleLabel.Position = UDim2.new(0, 15, 0, 0)
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Font = Enum.Font.GothamMedium
    TitleLabel.TextSize = 14
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Parent = TopBar

    local Sidebar = Instance.new("Frame")
    Sidebar.Name = "Sidebar"
    Sidebar.Position = UDim2.new(0, 0, 0, 40)
    Sidebar.Size = UDim2.new(0, 140, 1, -40)
    Sidebar.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
    Sidebar.BorderSizePixel = 0
    Sidebar.Parent = Container

    local ContentArea = Instance.new("Frame")
    ContentArea.Name = "Content"
    ContentArea.Position = UDim2.new(0, 140, 0, 40)
    ContentArea.Size = UDim2.new(1, -140, 1, -40)
    ContentArea.BackgroundTransparency = 1
    ContentArea.Parent = Container

    local function MakeDraggable(frame, parent)
        local dragging, dragInput, dragStart, startPos
        frame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = parent.Position
            end
        end)
        frame.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        UserInputService.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
                local delta = input.Position - dragStart
                parent.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
    end
    MakeDraggable(TopBar, Container)

    local Loader = {}
    local LFrameLeft, LFrameRight, LText
    
    if Main.LoaderEnabled then
        LFrameLeft = Instance.new("Frame")
        LFrameLeft.Size = UDim2.new(0.5, 0, 1, 0)
        LFrameLeft.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        LFrameLeft.BorderSizePixel = 0
        LFrameLeft.ZIndex = 10
        LFrameLeft.Parent = ScreenGui

        LFrameRight = Instance.new("Frame")
        LFrameRight.Size = UDim2.new(0.5, 0, 1, 0)
        LFrameRight.Position = UDim2.new(0.5, 0, 0, 0)
        LFrameRight.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        LFrameRight.BorderSizePixel = 0
        LFrameRight.ZIndex = 10
        LFrameRight.Parent = ScreenGui

        LText = Instance.new("TextLabel")
        LText.Size = UDim2.new(1, 0, 0, 50)
        LText.Position = UDim2.new(0, 0, 0.5, -25)
        LText.BackgroundTransparency = 1
        LText.TextColor3 = Color3.fromRGB(255, 255, 255)
        LText.Font = Enum.Font.GothamBold
        LText.TextSize = 24
        LText.Text = "INITIALIZING..."
        LText.ZIndex = 11
        LText.Parent = ScreenGui
    end

    function Loader:Start()
        LFrameLeft.Visible = true
        LFrameRight.Visible = true
    end

    function Loader:SetText(val)
        LText.Text = val:upper()
    end

    function Loader:End()
        TweenService:Create(LText, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
        task.wait(0.5)
        Container.Visible = true
        TweenService:Create(LFrameLeft, TweenInfo.new(0.8, Enum.EasingStyle.Quart, Enum.EasingDirection.InOut), {Position = UDim2.new(-0.5, 0, 0, 0)}):Play()
        TweenService:Create(LFrameRight, TweenInfo.new(0.8, Enum.EasingStyle.Quart, Enum.EasingDirection.InOut), {Position = UDim2.new(1, 0, 0, 0)}):Play()
        task.wait(0.8)
        LFrameLeft:Destroy()
        LFrameRight:Destroy()
        LText:Destroy()
    end

    local Tabs = {}
    function Main:Tab(Name)
        local TabBtn = Instance.new("TextButton")
        TabBtn.Size = UDim2.new(1, -20, 0, 30)
        TabBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        TabBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
        TabBtn.Font = Enum.Font.Gotham
        TabBtn.TextSize = 13
        TabBtn.Text = Name
        TabBtn.Parent = Sidebar
        Instance.new("UICorner", TabBtn).CornerRadius = UDim.new(0, 4)

        local Page = Instance.new("ScrollingFrame")
        Page.Size = UDim2.new(1, -20, 1, -20)
        Page.Position = UDim2.new(0, 10, 0, 10)
        Page.BackgroundTransparency = 1
        Page.Visible = false
        Page.ScrollBarThickness = 2
        Page.Parent = ContentArea

        local Layout = Instance.new("UIListLayout")
        Layout.Padding = UDim.new(0, 10)
        Layout.Parent = Page

        TabBtn.MouseButton1Click:Connect(function()
            for _, p in pairs(ContentArea:GetChildren()) do p.Visible = false end
            Page.Visible = true
        end)

        local SectionHandler = {}
        function SectionHandler:Section(SecName)
            local SecFrame = Instance.new("Frame")
            SecFrame.Size = UDim2.new(1, 0, 0, 30)
            SecFrame.BackgroundTransparency = 1
            SecFrame.Parent = Page

            local SecTitle = Instance.new("TextLabel")
            SecTitle.Text = SecName:upper()
            SecTitle.Size = UDim2.new(1, 0, 0, 20)
            SecTitle.TextColor3 = Color3.fromRGB(150, 150, 150)
            SecTitle.Font = Enum.Font.GothamBold
            SecTitle.TextSize = 11
            SecTitle.TextXAlignment = Enum.TextXAlignment.Left
            SecTitle.BackgroundTransparency = 1
            SecTitle.Parent = SecFrame

            local Div = Instance.new("Frame")
            Div.Size = UDim2.new(1, 0, 0, 1)
            Div.Position = UDim2.new(0, 0, 1, -2)
            Div.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            Div.BorderSizePixel = 0
            Div.Parent = SecFrame

            local ElementHandler = {}

            function ElementHandler:Button(txt, cb)
                local B = Instance.new("TextButton")
                B.Size = UDim2.new(1, 0, 0, 35)
                B.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
                B.Text = txt
                B.TextColor3 = Color3.fromRGB(255, 255, 255)
                B.Font = Enum.Font.Gotham
                B.TextSize = 13
                B.Parent = Page
                Instance.new("UICorner", B)
                B.MouseButton1Click:Connect(cb)
            end

            function ElementHandler:Toggle(txt, cb)
                local T = Instance.new("TextButton")
                T.Size = UDim2.new(1, 0, 0, 35)
                T.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
                T.Text = "  " .. txt
                T.TextColor3 = Color3.fromRGB(255, 255, 255)
                T.Font = Enum.Font.Gotham
                T.TextSize = 13
                T.TextXAlignment = Enum.TextXAlignment.Left
                T.Parent = Page
                Instance.new("UICorner", T)
                
                local State = false
                local Indicator = Instance.new("Frame")
                Indicator.Size = UDim2.new(0, 20, 0, 20)
                Indicator.Position = UDim2.new(1, -30, 0.5, -10)
                Indicator.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
                Indicator.Parent = T
                Instance.new("UICorner", Indicator).CornerRadius = UDim.new(1, 0)

                T.MouseButton1Click:Connect(function()
                    State = not State
                    TweenService:Create(Indicator, TweenInfo.new(0.3), {BackgroundColor3 = State and Color3.fromRGB(0, 255, 150) or Color3.fromRGB(50, 50, 50)}):Play()
                    cb(State)
                end)
            end

            return ElementHandler
        end
        return SectionHandler
    end

    return Main, Loader
end

return Library
